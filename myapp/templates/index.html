{% extends "home_master.html" %}

{% block title %}
  Home | Bentha Technologies
{% endblock %}

{% block content %}
    <script>
      function formatNumber(elementId) {
        var element = document.getElementById(elementId);
        if (element) {
          var formattedValue = parseFloat(element.innerText).toLocaleString();
          element.innerText = formattedValue;
        }
      }
    </script>
<section class="image-section" id="title" style="display: flex; width: 100%; flex-wrap: wrap;">
  <!-- Left column for categories -->
  <div class="left-column" style="width: 18%; min-width: 180px; flex: 0 0 auto; overflow: auto;">
      <h2 style="text-align: left;">Categories</h2>
      <ul class="category-list" style="text-align: left;">
          <li><a class="category-link" href="#" data-category="All">All Categories</a></li>
          {% for category in categories %}
              <li><a class="category-link" href="#" data-category="{{ category.name }}">{{ category.name }}</a></li>
          {% endfor %}
      </ul>
  </div>

  <!-- Right column for images -->
  <div class="right-column" id="product-container" style="width: 82%; min-height: calc(100vh - 100px); background-color: #ffffff; background-image: url('https://www.tmb.kit.edu/img/content/architecture-1048092_1920.jpg'); background-size: cover; background-position: center; flex: 1;">
      <input type="text" id="searchInput" placeholder="Search for products..." style="text-align: center; width: 100%; max-width: 1000px; margin: 5px 0;">
      <div class="searchResults" style="background-color: #b9cee2; width: 100%; min-height: calc(100vh - 100px); padding: 20px; display: flex; flex-wrap: wrap;">
          {% if categorized_images %}
              {% for category, images in categorized_images.items %}
                  {% if images %}
                      <div class="row">
                          <h2 style="text-align: center; margin-top: 15px;" id="{{ category.name }}">{{ category.name }}</h2>
                          {% for image in images %}
                              <div class="col-md-3 product-card" data-category="{{ category.name }}" style="display: flex; flex-direction: column;">
                                  <!-- Your image display code here -->
                                  <p><strong>Title: {{ image.title }}</strong></p>
                                  <a href="{{ image.image.url }}" target="_blank">
                                      <img src="{{ image.image.url }}" alt="Uploaded Image" style="width: 100%;">
                                  </a>
                                  {% if image.about_Image %}
                                      <p>{{ image.about_Image|wordwrap:40 }}</p>
                                  {% endif %}
                                  <p><strong>Uploaded At:</strong> {{ image.uploaded_at }}</p>
                                  <p><strong>Status:</strong> {{ image.status }}</p>
                                  <p><strong>Price:</strong> <span class="formattedNumber" data-field="price">{{ image.price|default:"" }}</span> ksh per {{ image.UnitOfMeasure }}</p>
                                  <p><strong>Price_Negotiable:</strong> <span class="formattedNumber" data-field="price">{{ image.price|default:"" }}</span> ksh per {{ image.Price_Negotiable }}</p>
                                  <div style="margin-top: auto;">
                                      <form method="POST" action="{% url 'login' %}?next={% url 'add_to_cart' image.id %}">
                                          {% csrf_token %}
                                          <button type="submit" class="custom-button" style="background-color: rgb(12, 129, 57);">Add to Cart</button>
                                      </form>
                                  </div>
                              </div>
                              {% if forloop.counter|divisibleby:4 %}
                                  <!-- Close the current row after every 4 images -->
                              </div>
                              <div class="row">
                              {% endif %}
                          {% endfor %}
                      </div>
                  {% endif %}
              {% endfor %}
          {% endif %}
      </div>
  </div>
</section>


<div class="full-page-container" id="notFoundContainer" style="display: none;">
  <h1 class="not-found-animation" style="color: red;">
      No items match your search.
      <!-- Add your "Not Found" gif here -->
      <img src="https://cdn.dribbble.com/users/595978/screenshots/3603965/media/250a710e7478f92ef5fbb41bae572d58.gif" alt="Not Found" width="100" height="100">
  </h1>
  <button onclick="refreshPage()" class="go-back-button" style="align-items: center;">Refresh</button>
</div>

<script>
    function refreshPage() {
        location.reload(); // This will reload the current page
    }
</script>

<script>
  // filter products with category
  document.addEventListener("DOMContentLoaded", function () {
    const categoryLinks = document.querySelectorAll(".category-link");
    const productCards = document.querySelectorAll(".product-card");

    categoryLinks.forEach(function (link) {
      link.addEventListener("click", function (event) {
        event.preventDefault();
        const selectedCategory = link.getAttribute("data-category");

        // Handle "All Categories" separately to show all products and categories
        if (selectedCategory === "All") {
          productCards.forEach(function (card) {
            card.style.display = "block";
          });

          categoryLinks.forEach(function (category) {
            category.style.display = "block";
          });
        } else {
          // Hide all product cards and category names except the selected one
          productCards.forEach(function (card) {
            const cardCategory = card.getAttribute("data-category");
            if (selectedCategory === "All" || cardCategory === selectedCategory) {
              card.style.display = "block";
            } else {
              card.style.display = "none";
            }
          });

          // Hide all category names except the selected one
          categoryLinks.forEach(function (category) {
            const categoryData = category.getAttribute("data-category");
            if (categoryData === selectedCategory || categoryData === "All") {
              category.style.display = "block";
            } else {
              category.style.display = "none";
            }
          });
        }
      });
    });
  });
</script>

<!-- Javascript to format separate on thousand using comma -->
<script>
  // formatNumber.js

document.addEventListener('DOMContentLoaded', function () {
  var formattedNumbers = document.querySelectorAll('.formattedNumber');

  formattedNumbers.forEach(function (element) {
    var field = element.dataset.field;
    var value = element.innerText;

    if (field === 'price') {
      // Format the number for the 'price' field
      var formattedValue = parseFloat(value).toLocaleString();
      element.innerText = formattedValue;
    }

    // Add more conditions for other fields if needed
  });
});

</script>


<script>
  // JavaScript code for search functionality
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchInput");
    const productList = document.querySelectorAll(".product-card");
    const notFoundContainer = document.getElementById("notFoundContainer");
    const leftColumn = document.querySelector(".left-column");
    const rightColumn = document.getElementById("product-container");

    searchInput.addEventListener("input", function () {
      const searchTerm = searchInput.value.trim().toLowerCase();
      let found = false;

      productList.forEach(function (product) {
        const title = product.querySelector("p strong").textContent.toLowerCase();
        const about = product.querySelector("p:nth-child(3)").textContent.toLowerCase();

        if (title.includes(searchTerm) || about.includes(searchTerm)) {
          product.style.display = "block";
          found = true;
        } else {
          product.style.display = "none";
        }
      });

      if (!found) {
        notFoundContainer.style.display = "block";
        leftColumn.style.display = "none";
        rightColumn.style.display = "none";
      } else {
        notFoundContainer.style.display = "none";
        leftColumn.style.display = "block";
        rightColumn.style.display = "block";
      }
      
      // Hide category names without associated products
      categoryLinks.forEach(function (category) {
        const categoryName = category.getAttribute("data-category");
        let categoryExists = false;
        productList.forEach(function (product) {
          const cardCategory = product.getAttribute("data-category");
          if (cardCategory === categoryName) {
            categoryExists = true;
          }
        });
        if (!categoryExists && categoryName !== "All") {
          const categoryHeader = document.getElementById(categoryName);
          if (categoryHeader) {
            categoryHeader.style.display = "none";
          }
        }
      });
    });
  });
</script>

</body>

</html>

{% endblock %}